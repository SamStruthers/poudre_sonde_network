---
title: "HydroVu API Pull"
author: "B Steele"
date: "`r Sys.Date()`"
output: html_document
---

# Purpose

This R-markdown accesses the HydroVu server via the API to download data within this scripted workflow. See the README.md file for directions to set up the credentials.yml file sourced in this script.

## Requirements

This Markdown uses R and Python chunks. It may be buggy, but all steps should be working. If you are having *any* issues, contact me an I'll take another shot at debugging. :-)

## Workspace Set Up

For grabbing data from HydroVu, we'll be using the credentials.yml file and the package 'HydroVuR', which is available on GitHub through devtools.

```{r}
devtools::install_github("jvandens/HydroVuR")
library('tidyverse')
library('HydroVuR')

```

## Accessing the API

First thing, we're going to read in our client id and client secret for accessing the HydroVu API. Don't print these out in this chunk: if you save your Rmd file with the chunk history, that's another way that the world can see your data. :)

```{r}
creds = yaml::read_yaml('credentials.yml')

client_id = as.character(creds['client'])
client_secret = as.character(creds['secret'])

# get a token for location lists and data access
token <- hv_auth(client_id, client_secret)
```

Get location list:

```{r}
#need to turn off scientific notation
options(scipen = 999)
# get the locations
locs <- hv_locations(token) 

#make a list of site names
loc_list <- locs$name

loc_id <- locs$id
```

Get data:

```{r}
# function to get data
get_data <- function(site, startdate, enddate){
  data <- hv_data(site, startdate, enddate, tz = 'UTC', token)
  data
}

get_data(loc_list[3], '2022-07-01 00:00:00', '2022-08-01 00:00:00')


```

```{r}

# get the Friendly Names for parameters and units for reference.
# can be returned indiviually as data.frames or as a list of both data.frames
params <- hv_names(token, return = "params")
units <- hv_names(token, return = "units")
both <- hv_names(token)
```
